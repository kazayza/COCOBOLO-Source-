Option Compare Database

Private Sub btnChangePassword_Click()

    Dim db As DAO.Database
    Dim rs As DAO.Recordset
    Dim strSQL As String
    Dim UserId As Long   ' √Ê «”„ «·„” Œœ„ Õ”» ‰Ÿ«„ﬂ
    Dim oldPass As String, newPass As String, confirmPass As String

    On Error GoTo ErrHandler

    ' «Ã„⁄ «·»Ì«‰«  „‰ «·›Ê—„
    oldPass = Nz(Me.txtOldPassword.value, "")
    newPass = Nz(Me.txtNewPassword.value, "")
    confirmPass = Nz(Me.txtConfirmPassword.value, "")
    UserId = currentUser.UserId 'Nz(Me.txtUserID.Value, 0)  ' √Ê ·Ê ⁄‰œﬂ „ €Ì— Ã·”… UserID

    '  Õﬁﬁ „‰ ≈œŒ«· «·ÕﬁÊ·
    If oldPass = "" Or newPass = "" Or confirmPass = "" Then
        MsgBox "„‰ ›÷·ﬂ √œŒ· Ã„Ì⁄ «·ÕﬁÊ·.", vbExclamation
        Exit Sub
    End If

    '  Õﬁﬁ √‰ «·ÃœÌœ = ≈⁄«œ… «·ÃœÌœ
    If newPass <> confirmPass Then
        MsgBox "ﬂ·„… «·”— «·ÃœÌœ… €Ì— „ ÿ«»ﬁ….", vbCritical
        Exit Sub
    End If

    ' «› Õ ÃœÊ· «·„” Œœ„Ì‰ Ê Õﬁﬁ „‰ «·»«”Ê—œ «·ﬁœÌ„
    strSQL = "SELECT * FROM dbo_Users WHERE UserID=" & UserId
    Set db = CurrentDb
    Set rs = db.OpenRecordset(strSQL, dbOpenDynaset, dbSeeChanges)

    If rs.EOF Then
        MsgBox "«·„” Œœ„ €Ì— „ÊÃÊœ.", vbCritical
        Exit Sub
    End If

    If rs!Password <> oldPass Then
        MsgBox "ﬂ·„… «·”— «·ﬁœÌ„… €Ì— ’ÕÌÕ….", vbCritical
        Exit Sub
    End If

    ' Õœ¯À «·»«”Ê—œ
    rs.Edit
    rs!Password = newPass
    rs.Update

    MsgBox " „  €ÌÌ— ﬂ·„… «·”— »‰Ã«Õ.", vbInformation
    Me.txtOldPassword = ""
    Me.txtNewPassword = ""
    Me.txtConfirmPassword = ""
    rs.Close
    Set rs = Nothing
    Set db = Nothing
    Exit Sub

ErrHandler:
    MsgBox "ÕœÀ Œÿ√: " & Err.Description, vbCritical

End Sub


