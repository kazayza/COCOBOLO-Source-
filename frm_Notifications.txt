Option Compare Database

'Private Sub Command61_Click()
'
'    Dim nid As Long
'    Dim targetForm As String
'    Dim relID As Long
'
'    nid = Nz(Me!NotificationID, 0)
'    If nid = 0 Then Exit Sub
'
'    ' ⁄·„ «·«‘⁄«— ﬂ„ﬁ—Ê¡
'    MarkNotificationRead nid   ' «” Œœ„ œ«· ﬂ «·„ÊÃÊœ… („⁄ dbSeeChanges)
'
'    ' «› Õ «·›Ê—„ «·„— »ÿ ≈‰ ÊıÃœ
'    targetForm = Nz(Me!formName, "")
'    relID = Nz(Me!RelatedID, 0)
'
'    If targetForm <> "" Then
'        OpenFormFromNotification targetForm, relID
'    Else
'        ' ·Ê „›Ì‘ ›Ê—„ „— »ÿ° «› Õ ”Ã· «·«‘⁄«— »«· ›’Ì·
'        DoCmd.OpenForm "frm_Notifications", , , "NotificationID=" & nid
'    End If
'    Me.Requery
'    ' ÕœÀ «·»«œÃ ›Ì «·›Ê—„ «·—∆Ì”Ì (Parent)
'    On Error Resume Next
'    Me.Parent.UpdateUnreadBadge
'    DoCmd.Close acForm, "frm_Notifications"
'    On Error GoTo 0
'End Sub
Private Sub Command61_Click()
    Dim nID As Long
    Dim targetForm As String
    Dim relID As Long
    Dim reminderChoice As VbMsgBoxResult
    Dim reminderDays As Integer
    Dim reminderIntervalHours As Integer
    Dim ReminderEndAt As Date
    Dim ReminderNextAt As Date
    Dim sql As String

    nID = Nz(Me!NotificationID, 0)
    If nID = 0 Then Exit Sub

    ' ? ”ƒ«· «·„” Œœ„ ≈–« ﬂ«‰ Ì—Ìœ «· –ﬂÌ—
    reminderChoice = MsgBox("Â·  —Ìœ  ›⁄Ì· «· –ﬂÌ— ·Â–« «·≈‘⁄«—ø", vbYesNo + vbQuestion, " ›⁄Ì· «· –ﬂÌ—")
    If reminderChoice = vbYes Then
        ' ≈œŒ«· ⁄œœ «·√Ì«„ ·· –ﬂÌ— («·„œ… «·ﬂ·Ì…)
        reminderDays = val(InputBox("√œŒ· ⁄œœ «·√Ì«„ «· Ì  —€» ›Ì  ›⁄Ì· «· –ﬂÌ— Œ·«·Â«:", "„œ… «· –ﬂÌ—", "2"))
        If reminderDays <= 0 Then reminderDays = 1   ' ﬁÌ„… «› —«÷Ì…

        ' ≈œŒ«· ⁄œœ «·”«⁄«  »Ì‰ ﬂ·  –ﬂÌ—
        reminderIntervalHours = val(InputBox("ﬂ· ﬂ„ ”«⁄…  —Ìœ  ﬂ—«— «· –ﬂÌ—ø", "›«’· «· –ﬂÌ—", "2"))
        If reminderIntervalHours <= 0 Then reminderIntervalHours = 2   ' ﬁÌ„… «› —«÷Ì…

        ' Õ”«» «· Ê«—ÌŒ
        ReminderNextAt = DateAdd("h", reminderIntervalHours, Now)
        ReminderEndAt = DateAdd("d", reminderDays, Now)

        ' ?  ÕœÌÀ »Ì«‰«  «· –ﬂÌ— ›Ì «·ÃœÊ·
        sql = "UPDATE dbo_Notifications SET " & _
              "ReminderEnabled = 1, " & _
              "ReminderIntervalMinutes = " & (reminderIntervalHours * 60) & ", " & _
              "ReminderNextAt = #" & Format(ReminderNextAt, "yyyy\/mm\/dd hh:nn:ss") & "#, " & _
              "ReminderEndAt = #" & Format(ReminderEndAt, "yyyy\/mm\/dd hh:nn:ss") & "# " & _
              "WHERE NotificationID = " & nID

        CurrentDb.Execute sql, dbSeeChanges
    End If

    ' ? ⁄·„ «·≈‘⁄«— ﬂ„ﬁ—Ê¡
    MarkNotificationRead nID

    ' ? «› Õ «·›Ê—„ «·„— »ÿ
    targetForm = Nz(Me!FormName, "")
    relID = Nz(Me!RelatedID, 0)

      If targetForm <> "" Then
      If targetForm = "frm_SalesInvoiveNew" Then
      
 DoCmd.OpenForm "frm_SalesInvoiveNew", , , , , , OpenArgs:="EDIT|" & relID
 Else
                OpenFormFromNotification targetForm, relID
        End If
    Else
        DoCmd.OpenForm "frm_Notifications", , , "NotificationID=" & nID
    End If

    Me.Requery

    ' ?  ÕœÌÀ «·»«œÃ ›Ì «·›Ê—„ «·—∆Ì”Ì
    On Error Resume Next
    Me.Parent.UpdateUnreadBadge
    DoCmd.Close acForm, "frm_Notifications"
    On Error GoTo 0
End Sub

Private Sub Form_Load()
    Dim sql As String
    Dim currentUserName As String

    ' Ã·» «”„ «·„” Œœ„ «·Õ«·Ì
    currentUserName = currentUser.UserName  ' √Ê Environ$("USERNAME") ·Ê CurrentUser „‘ „ÊÃÊœ

    '  ﬂÊÌ‰ «·«” ⁄·«„ ··œ« « «·Œ«’… »«·„” Œœ„ «·Õ«·Ì
    sql = "SELECT * FROM dbo_Notifications " & _
          "WHERE IsRead = 0 " & _
          "AND RecipientUser = '" & Replace(currentUserName, "'", "''") & "'"
Me.Text81 = "  «·«‘⁄«—«  «·Œ«’… »‹ :  " & currentUser.FullName
    '  ⁄ÌÌ‰ «·«” ⁄·«„ ﬂ„’œ— ··›Ê—„
    Me.RecordSource = sql
    Me.Requery  ' ≈⁄«œ…  Õ„Ì· «·»Ì«‰«  ›Ì «·›Ê—„
End Sub

