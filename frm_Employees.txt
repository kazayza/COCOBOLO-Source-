Option Compare Database


'Private Sub btnEdit_Click()
'    On Error GoTo ErrHandler
'
'    Dim db As DAO.Database
'    Dim rs As DAO.Recordset
'    Dim EmpId As Long
'
'    '  √ﬂœ ≈‰ «·„⁄—› „ÊÃÊœ (·«“„ ÌﬂÊ‰ „ÊÃÊœ ›Ì «·›Ê—„ ﬂÕﬁ· „Œ›Ì √Ê „› «Õ —∆Ì”Ì)
'    EmpId = Nz(Me.EmployeeID, 0) ' «” »œ· EmployeeID »«”„ «·Õﬁ· «·„ÊÃÊœ ⁄‰œﬂ ›Ì «·›Ê—„
'
'    If EmpId = 0 Then
'        MsgBox "·« Ì„ﬂ‰  ⁄œÌ· «·„ÊŸ›. „⁄—› «·„ÊŸ› €Ì— „ÊÃÊœ.", vbExclamation, "COCOBOLO SYSTEM"
'        Exit Sub
'    End If
'
'    ' «· Õﬁﬁ „‰ «·»Ì«‰«  «·√”«”Ì…
'    If Trim(Nz(Me.FullName, "")) = "" Then
'        MsgBox "„‰ ›÷·ﬂ √œŒ· «”„ «·„ÊŸ›", vbExclamation, "COCOBOLO SYSTEM"
'        Exit Sub
'    End If
'
'    If Len(Me.NationalID) <> 14 Or Not IsNumeric(Me.NationalID) Then
'        MsgBox "„‰ ›÷·ﬂ √œŒ· —ﬁ„ ﬁÊ„Ì ’ÕÌÕ „ﬂÊ‰ „‰ 14 —ﬁ„", vbExclamation, "COCOBOLO SYSTEM"
'        Exit Sub
'    End If
'
'    Set db = CurrentDb
'    Set rs = db.OpenRecordset("dbo_Employees", dbOpenDynaset, dbSeeChanges)
'
'    rs.FindFirst "EmployeeID = " & EmpId
'
'    If rs.NoMatch Then
'        MsgBox "«·„ÊŸ› €Ì— „ÊÃÊœ ·· ⁄œÌ·.", vbExclamation, "COCOBOLO SYSTEM"
'        rs.Close
'        Set rs = Nothing
'        Set db = Nothing
'        Exit Sub
'    Else
'        rs.Edit
'        rs!FullName = Me.FullName
'        rs!NationalID = Me.NationalID
'        rs!JobTitle = Me.JobTitle
'        rs!Department = Me.Department
'        rs!BirthDate = Me.BirthDate
'        rs!Gender = Me.Gender
'        rs!BioEmployeeID = Me.BioEmployeeID
'        rs!IsPermanentlyExempt = CBool(Me.chkBio)
'        rs!qualification = Me.qualification
'        rs!yearqualification = Me.yearqualification
'        rs!Address = Nz(Me.Address, "")
'        rs!MobilePhone = Nz(Me.MobilePhone, "")
'        rs!MobilePhone2 = Nz(Me.MobilePhone2, "")
'        rs!CurrentSalaryBase = Nz(Me.CurrentSalaryBase, 0)
'        rs!EmailAddress = Me.EmailAddress
'        rs!HireDate = Me.HireDate
'        rs!EndDate = Me.EndDate
'        rs!Status = Me.Status
'        rs!Notes = Me.Notes
'        ' „„ﬂ‰  ÕœÀ CreatedBy Ê CreatedAt ·Ê ⁄«Ì“° √Ê  ÷Ì› ÕﬁÊ·  ÕœÌÀ „À· ModifiedBy Ê ModifiedAt
'        rs.Update
'    End If
'
'    rs.Close
'    Set rs = Nothing
'    Set db = Nothing
'
'    MsgBox " „  ⁄œÌ· »Ì«‰«  «·„ÊŸ› »‰Ã«Õ", vbInformation, "COCOBOLO SYSTEM"
'    Me.Requery
'    Exit Sub
'
'ErrHandler:
'    MsgBox "Œÿ√ √À‰«¡ «· ⁄œÌ·: " & Err.Description, vbCritical, "COCOBOLO SYSTEM"
'End Sub
Private Sub btnEdit_Click()
    On Error GoTo ErrHandler

    Dim db As DAO.Database
    Dim rs As DAO.Recordset
    Dim EmpId As Long

    ' ﬁ—«¡… «·‹ ID „‰ «·›Ê—„
    EmpId = Nz(Me.EmployeeID, 0)

    If EmpId = 0 Then
        MsgBox "·« Ì„ﬂ‰  ⁄œÌ· «·„ÊŸ›. „⁄—› «·„ÊŸ› €Ì— „ÊÃÊœ.", vbExclamation, "COCOBOLO SYSTEM"
        Exit Sub
    End If

    ' «· Õﬁﬁ „‰ «·»Ì«‰«  «·√”«”Ì…
    If Trim(Nz(Me.FullName, "")) = "" Then
        MsgBox "„‰ ›÷·ﬂ √œŒ· «”„ «·„ÊŸ›", vbExclamation, "COCOBOLO SYSTEM"
        Exit Sub
    End If

    ' «· Õﬁﬁ „‰ «·—ﬁ„ «·ﬁÊ„Ì
    If Len(Me.NationalID & "") <> 14 Or Not IsNumeric(Me.NationalID & "") Then
        MsgBox "„‰ ›÷·ﬂ √œŒ· —ﬁ„ ﬁÊ„Ì ’ÕÌÕ „ﬂÊ‰ „‰ 14 —ﬁ„", vbExclamation, "COCOBOLO SYSTEM"
        Exit Sub
    End If

    Set db = CurrentDb
    Set rs = db.OpenRecordset("dbo_Employees", dbOpenDynaset, dbSeeChanges)

    ' «·»ÕÀ ⁄‰ «·„ÊŸ›
    rs.FindFirst "EmployeeID = " & EmpId

    If rs.NoMatch Then
        MsgBox "«·„ÊŸ› €Ì— „ÊÃÊœ ·· ⁄œÌ·.", vbExclamation, "COCOBOLO SYSTEM"
        rs.Close
        Set rs = Nothing
        Set db = Nothing
        Exit Sub
    End If

    ' ****  ⁄œÌ· «·»Ì«‰«  ****
    rs.Edit

    rs!FullName = Nz(Me.FullName, "")
    rs!NationalID = Nz(Me.NationalID, "")
    rs!JobTitle = Nz(Me.JobTitle, "")
    rs!Department = Nz(Me.Department, "")
    rs!BirthDate = IIf(IsDate(Me.BirthDate), Me.BirthDate, Null)
    rs!Gender = Nz(Me.Gender, "")

    ' „⁄«·Ã… BioEmployeeID (INT Ì”„Õ »‹ NULL)
    If Trim(Me.BioEmployeeID & "") = "" Then
        rs!BioEmployeeID = Null
    Else
        If IsNumeric(Me.BioEmployeeID) Then
            rs!BioEmployeeID = CLng(Me.BioEmployeeID)
        Else
            MsgBox "„‰ ›÷·ﬂ √œŒ· —ﬁ„ ’ÕÌÕ ·ﬂÊœ «·»’„…", vbExclamation, "COCOBOLO SYSTEM"
            rs.CancelUpdate
            Exit Sub
        End If
    End If

    rs!IsPermanentlyExempt = Nz(Me.chkBio, False)
    rs!qualification = Nz(Me.qualification, "")
    rs!yearqualification = Nz(Me.yearqualification, "")
    rs!Address = Nz(Me.Address, "")
    rs!MobilePhone = Nz(Me.MobilePhone, "")
    rs!MobilePhone2 = Nz(Me.MobilePhone2, "")
    rs!CurrentSalaryBase = Nz(Me.CurrentSalaryBase, 0)
    rs!EmailAddress = Nz(Me.EmailAddress, "")
    rs!HireDate = IIf(IsDate(Me.HireDate), Me.HireDate, Null)
    rs!EndDate = IIf(IsDate(Me.EndDate), Me.EndDate, Null)
    rs!Status = Nz(Me.Status, "‰‘ÿ")
    rs!Notes = Nz(Me.Notes, "")

    '  ÕœÌÀ «·”Ã·
    rs.Update

    rs.Close
    Set rs = Nothing
    Set db = Nothing

    MsgBox " „  ⁄œÌ· »Ì«‰«  «·„ÊŸ› »‰Ã«Õ", vbInformation, "COCOBOLO SYSTEM"
    Me.Requery
    Exit Sub

ErrHandler:
    MsgBox "Œÿ√ √À‰«¡ «· ⁄œÌ·: " & Err.Number & vbCrLf & Err.Description, vbCritical, "COCOBOLO SYSTEM"
End Sub



'Private Sub btnSave_Click()
'
'    On Error GoTo ErrHandler
'
'    Dim db As DAO.Database
'
'    ' «· Õﬁﬁ „‰ «·»Ì«‰«  «·√”«”Ì…
'    If Trim(Nz(Me.FullName, "")) = "" Then
'        MsgBox "„‰ ›÷·ﬂ √œŒ· «”„ «·„ÊŸ›", vbExclamation, "COCOBOLO SYSTEM"
'        Exit Sub
'    End If
'
'    If Len(NationalID) <> 14 Or Not IsNumeric(NationalID) Then
'        MsgBox "„‰ ›÷·ﬂ √œŒ· —ﬁ„ ﬁÊ„Ì ’ÕÌÕ „ﬂÊ‰ „‰ 14 —ﬁ„", vbExclamation, "COCOBOLO SYSTEM"
'        Exit Sub
'    End If
'
'
'    ' Õ›Ÿ «·»Ì«‰«  ›Ì «·ÃœÊ·
'    Set db = CurrentDb
'    Set rs = db.OpenRecordset("dbo_Employees", dbOpenDynaset, dbSeeChanges)
'
'    rs.AddNew
'    rs!FullName = Me.FullName
'    rs!NationalID = Me.NationalID
'    rs!JobTitle = Me.JobTitle
'    rs!Department = Me.Department
'    rs!BirthDate = Me.BirthDate
'    rs!Gender = Me.Gender
'    rs!BioEmployeeID = Nz(Me.BioEmployeeID, "")
'    rs!IsPermanentlyExempt = CBool(Me.chkBio)
'    rs!qualification = Me.qualification
'    rs!yearqualification = Me.yearqualification
'    rs!Address = Nz(Me.Address, "")
'    rs!MobilePhone = Nz(Me.MobilePhone, "")
'    rs!MobilePhone2 = Nz(Me.MobilePhone2, "")
'    rs!CurrentSalaryBase = Nz(Me.CurrentSalaryBase, 0)
'    rs!EmailAddress = Me.EmailAddress
'    rs!HireDate = Me.HireDate
'    rs!EndDate = Me.EndDate
'    rs!Status = Me.Status
'    rs!Notes = Me.Notes
'    rs!CreatedBy = currentUser.UserName
'    rs!CreatedAt = Now()
'    rs.Update
'
'    rs.Close
'    Set rs = Nothing
'    Set db = Nothing
'
'    MsgBox " „ Õ›Ÿ »Ì«‰«  «·„ÊŸ› »‰Ã«Õ", vbInformation, "COCOBOLO SYSTEM"
'    Me.Requery
'    Exit Sub
'
'ErrHandler:
'    MsgBox "Œÿ√ √À‰«¡ «·Õ›Ÿ: " & Err.Description, vbCritical, "COCOBOLO SYSTEM"
'End Sub
Private Sub btnSave_Click()

    On Error GoTo ErrHandler

    Dim db As DAO.Database
    Dim rs As DAO.Recordset

    ' «· Õﬁﬁ „‰ «·»Ì«‰«  «·√”«”Ì…
    If Trim(Nz(Me.FullName, "")) = "" Then
        MsgBox "„‰ ›÷·ﬂ √œŒ· «”„ «·„ÊŸ›", vbExclamation, "COCOBOLO SYSTEM"
        Exit Sub
    End If

    ' —ﬁ„ ﬁÊ„Ì ’ÕÌÕ
    If Len(Me.NationalID & "") <> 14 Or Not IsNumeric(Me.NationalID & "") Then
        MsgBox "„‰ ›÷·ﬂ √œŒ· —ﬁ„ ﬁÊ„Ì ’ÕÌÕ „ﬂÊ‰ „‰ 14 —ﬁ„", vbExclamation, "COCOBOLO SYSTEM"
        Exit Sub
    End If

    Set db = CurrentDb
    Set rs = db.OpenRecordset("dbo_Employees", dbOpenDynaset, dbSeeChanges)

    rs.AddNew

    rs!FullName = Nz(Me.FullName, "")
    rs!NationalID = Nz(Me.NationalID, "")
    rs!JobTitle = Nz(Me.JobTitle, "")
    rs!Department = Nz(Me.Department, "")
    rs!BirthDate = IIf(IsDate(Me.BirthDate), Me.BirthDate, Null)
    rs!Gender = Nz(Me.Gender, "")
'    rs!BioEmployeeID = Nz(Me.BioEmployeeID, "")
If Trim(Me.BioEmployeeID & "") = "" Then
    rs!BioEmployeeID = Null
Else
    If IsNumeric(Me.BioEmployeeID) Then
        rs!BioEmployeeID = CLng(Me.BioEmployeeID)
    Else
        MsgBox "„‰ ›÷·ﬂ √œŒ· —ﬁ„ ’ÕÌÕ ·ﬂÊœ «·»’„…", vbExclamation, "COCOBOLO SYSTEM"
        Exit Sub
    End If
End If

    rs!IsPermanentlyExempt = Nz(Me.chkBio, False)
    rs!qualification = Nz(Me.qualification, "")
    rs!yearqualification = Nz(Me.yearqualification, "")
    rs!Address = Nz(Me.Address, "")
    rs!MobilePhone = Nz(Me.MobilePhone, "")
    rs!MobilePhone2 = Nz(Me.MobilePhone2, "")
    rs!CurrentSalaryBase = Nz(Me.CurrentSalaryBase, 0)
    rs!EmailAddress = Nz(Me.EmailAddress, "")
    rs!HireDate = IIf(IsDate(Me.HireDate), Me.HireDate, Null)
    rs!EndDate = IIf(IsDate(Me.EndDate), Me.EndDate, Null)
    rs!Status = Nz(Me.Status, "‰‘ÿ")
    rs!Notes = Nz(Me.Notes, "")

    ' ”Ã· «·≈‰‘«¡
    If Not IsNull(currentUser.UserName) Then
        rs!CreatedBy = currentUser.UserName
    Else
        rs!CreatedBy = "SYSTEM"
    End If

    rs!CreatedAt = Now()

    rs.Update

    rs.Close
    Set rs = Nothing
    Set db = Nothing

    MsgBox " „ Õ›Ÿ »Ì«‰«  «·„ÊŸ› »‰Ã«Õ", vbInformation, "COCOBOLO SYSTEM"
    Me.Requery
    Exit Sub

ErrHandler:
    MsgBox "Œÿ√ √À‰«¡ «·Õ›Ÿ: " & Err.Number & vbCrLf & Err.Description, vbCritical, "COCOBOLO SYSTEM"
End Sub

Private Sub Form_Current()
If Me.Status = "„ÊﬁÊ›" Then
Me.Label83.Visible = True
Me.EndDate.Visible = True
Else
Me.Label83.Visible = False
Me.EndDate.Visible = False
End If
End Sub

Private Sub Form_Load()
    Dim EmpId As Long
    Dim db As DAO.Database
    Dim rs As DAO.Recordset
    Dim sql As String

    If IsNull(Me.OpenArgs) Then
        'MsgBox "·„ Ì „  ÕœÌœ „ÊŸ› ··⁄—÷.", vbExclamation
        Me.btnSave.Visible = True
        Me.btnEdit.Visible = False
        Me.cmdEnterNumber.Visible = False
        Me.Label66.Caption = "≈÷«›… „ÊŸ› ÃœÌœ"
        Exit Sub
        Else
         Me.btnSave.Visible = False
        Me.btnEdit.Visible = True
        Me.cmdEnterNumber.Visible = True
        Me.Label66.Caption = " ⁄œÌ· »Ì«‰«  «·„ÊŸ› «·Õ«·Ï"
    End If

    EmpId = CLng(Me.OpenArgs)
    Set db = CurrentDb

    sql = "SELECT * FROM dbo_Employees WHERE EmployeeID = " & EmpId
    Set rs = db.OpenRecordset(sql, dbOpenSnapshot)

    If Not rs.EOF Then
        Me.FullName = Nz(rs!FullName, "")
        Me.JobTitle = Nz(rs!JobTitle, "")
        Me.Department = Nz(rs!Department, "")
        Me.CurrentSalaryBase = Nz(rs!CurrentSalaryBase, 0)
        Me.NationalID = Nz(rs!NationalID, "")
        Me.BioEmployeeID = Nz(rs!BioEmployeeID, "")
        Me.chkBio = Nz(rs!IsPermanentlyExempt, False)
        Me.Gender = Nz(rs!Gender, "")
        Me.BirthDate = Nz(rs!BirthDate, "")
        Me.qualification = Nz(rs!qualification, "")
        Me.yearqualification = Nz(rs!yearqualification, "")
        Me.MobilePhone = Nz(rs!MobilePhone, "")
        Me.MobilePhone2 = Nz(rs!MobilePhone2, "")
        Me.EmailAddress = Nz(rs!EmailAddress, "")
        Me.Address = Nz(rs!Address, "")
        Me.HireDate = Nz(rs!HireDate, "")
        Me.EndDate = Nz(rs!EndDate, "")
        Me.Status = rs!Status
        Me.Notes = Nz(rs!Notes, "")
        Me.EmployeeID = Nz(rs!EmployeeID, "")
        ' ... «„·√ »«ﬁÌ «·ÕﬁÊ· »‰›” «·ÿ—Ìﬁ…
    Else
        MsgBox "«·„ÊŸ› €Ì— „ÊÃÊœ.", vbExclamation, "COCOBOLO SYSTEM"
        DoCmd.Close acForm, Me.Name
    End If

    rs.Close
    Set rs = Nothing
    Set db = Nothing
End Sub

Private Sub Form_Open(Cancel As Integer)
 If Not currentUser.HasPermission(Me.Name) Then
        Cancel = True
        MsgBox "€Ì— „’—Õ ·ﬂ »«·œŒÊ·", vbExclamation
        DoCmd.Close acForm, Me.Name
    End If
End Sub

Private Sub NationalID_AfterUpdate()
    Dim natID As String
    Dim yearPart As Integer, monthPart As Integer, dayPart As Integer
    Dim century As Integer
    Dim BirthDate As Date
    Dim genderDigit As Integer
    Dim Gender As String

    natID = Me.NationalID & ""

    ' «· Õﬁﬁ „‰ √‰ «·—ﬁ„ «·ﬁÊ„Ì 14 —ﬁ„
    If Len(natID) = 14 And IsNumeric(natID) Then

        '  ÕœÌœ «·ﬁ—‰
        Select Case Mid(natID, 1, 1)
            Case "2"
                century = 1900
            Case "3"
                century = 2000
            Case Else
                MsgBox "«·—ﬁ„ «·ﬁÊ„Ì €Ì— ’ÕÌÕ", vbExclamation, "COCOBOLO SYSTEM"
                Exit Sub
        End Select

        ' «” Œ—«Ã  «—ÌŒ «·„Ì·«œ
        yearPart = CInt(Mid(natID, 2, 2))
        monthPart = CInt(Mid(natID, 4, 2))
        dayPart = CInt(Mid(natID, 6, 2))

        BirthDate = DateSerial(century + yearPart, monthPart, dayPart)
        Me.BirthDate = BirthDate

        ' «” Œ—«Ã «·‰Ê⁄
        genderDigit = CInt(Mid(natID, 13, 1))
        If genderDigit Mod 2 = 0 Then
            Gender = "√‰ÀÏ"
        Else
            Gender = "–ﬂ—"
        End If
        Me.Gender = Gender

    Else
        MsgBox "„‰ ›÷·ﬂ √œŒ· —ﬁ„ ﬁÊ„Ì ’ÕÌÕ „ﬂÊ‰ „‰ 14 —ﬁ„", vbExclamation, "COCOBOLO SYSTEM"
    End If
End Sub

Private Sub cmdEnterNumber_Click()

    Dim EmpId As Long
    Dim newSalary As Currency
    Dim oldSalary As Currency
    Dim strInput As String
    Dim UserName As String
    Dim sqlU As String, sqlI As String

    On Error GoTo ErrHandler

    '  √ﬂœ ≈‰ ⁄‰œﬂ ﬁÌ„… ·„⁄—› «·„ÊŸ› „‰ «·›Ê—„
    EmpId = Nz(Me.EmployeeID, 0)
    If EmpId = 0 Then
        MsgBox "·„ Ì „  ÕœÌœ «·„ÊŸ›.", vbExclamation, "COCOBOLO SYSTEM"
        Exit Sub
    End If

    ' ﬁ—«¡… «·„— » «·ﬁœÌ„ „‰ «·ÃœÊ· («··Ì‰ﬂœ  Ì»· ›Ì √ﬂ”” «”„Â dbo_Employees)
    oldSalary = Nz(DLookup("CurrentSalaryBase", "dbo_Employees", "EmployeeID=" & EmpId), 0)

    ' ÿ·» «·„— » «·ÃœÌœ
    strInput = InputBox("«ﬂ » «·„— » «·√”«”Ì «·ÃœÌœ:", " ⁄œÌ· «·„— »", oldSalary)
    If Len(strInput) = 0 Then Exit Sub       ' «·„” Œœ„ ·€Ï

    If Not IsNumeric(strInput) Then
        MsgBox "„‰ ›÷·ﬂ √œŒ· —ﬁ„ ’ÕÌÕ.", vbExclamation, "COCOBOLO SYSTEM"
        Exit Sub
    End If

    newSalary = CCur(strInput)

    If newSalary = oldSalary Then
        MsgBox "·« ÌÊÃœ  €ÌÌ— ›Ì «·„— ».", vbInformation, "COCOBOLO SYSTEM"
        Exit Sub
    End If

    ' «”„ «·„” Œœ„ (Ê √„Ì‰ ⁄·«„«  «·«ﬁ »«”)
    UserName = currentUser.UserName ' Replace(Environ$("USERNAME"), "'", "''")

    ' 1)  ÕœÌÀ «·„— » ›Ì Employees
    sqlU = "UPDATE dbo_Employees " & _
           "SET CurrentSalaryBase=" & Replace(CStr(newSalary), ",", ".") & _
           " WHERE EmployeeID=" & EmpId
    CurrentDb.Execute sqlU, dbSeeChanges

    ' 2)  ”ÃÌ· «· €ÌÌ— ›Ì SalaryHistory
    ' „·«ÕŸ…: «·⁄„Êœ «·’ÕÌÕ ÂÊ CreatedBy („‘ ChangedBy)° ÊChangeDate ·ÌÂ DEFAULT ›Ì SQL Server
    sqlI = "INSERT INTO dbo_SalaryHistory (EmployeeID, OldSalary, NewSalary, CreatedBy) VALUES (" & _
            EmpId & ", " & Replace(CStr(oldSalary), ",", ".") & ", " & Replace(CStr(newSalary), ",", ".") & ", '" & UserName & "')"
    CurrentDb.Execute sqlI, dbSeeChanges

    ' ⁄ﬂ” «·ﬁÌ„… «·ÃœÌœ… ⁄·Ï «·›Ê—„ ›Ê—«
    Me.CurrentSalaryBase = newSalary
    If Me.Dirty Then Me.Dirty = False

    MsgBox " „  ⁄œÌ· «·„— » «·√”«”Ì Ê ”ÃÌ· «· €ÌÌ— »‰Ã«Õ.", vbInformation, "COCOBOLO SYSTEM"
    Exit Sub

ErrHandler:
    MsgBox "ÕœÀ Œÿ√: " & Err.Number & " - " & Err.Description, vbCritical, "COCOBOLO SYSTEM"
End Sub


Private Sub Status_AfterUpdate()
If Me.Status = "‰‘ÿ" Then
Me.EndDate.Visible = False
Me.Label83.Visible = False
ElseIf Me.Status = "„ÊﬁÊ›" Then
Me.EndDate.Visible = True
Me.Label83.Visible = True
End If
End Sub
